\chapter{รายละเอียดการปฏิบัติงาน}
\label{chapter:related-theory}

เริ่มสหกิจศึกษาโดยปฏิบัติงานที่ บริษัท วงใน มีเดีย จำกัด (สำนักงานใหญ่) ตั้งแต่วันที่ 4 มิถุนายน พ.ศ.2562 จนถึง 29 พฤศจิกายน พ.ศ.2562 รวมเป็นระยะเวลาประมาณ 6 เดือน โดยในการปฏิบัติงานต่าง ๆ ในช่วงสหกิจศึกษา มีรายละเอียดดังต่อไป

\section{ตำแหน่ง/หน้าที่ของงานที่ได้รับมอบหมาย}
ปฏิบัติงานด้วยตำแหน่ง Software Engineer (Backend) ทำหน้าที่รับผิดชอบในการพัฒนาและดูแลเซิร์ฟเวอร์ของเว็บไซต์ wongnai.com เพื่อให้ผู้ใช้งานทุกแพลตฟอร์มทั้ง  Web และ Mobile Application สามารถทำงานร่วมกันได้อย่างมีประสิทธิภาพ, ควบคุมคุณภาพของโค้ดให้มีคุณภาพที่ดี, ทำงานได้ถูกต้อง, ทดสอบและดูแลได้ง่าย, มีความยืดหยุ่นพร้อมรับการเปลี่ยนแปลงในอนาคต

\section{รายละเอียดของโครงงานที่รับผิดชอบ}
โครงงานที่รับผิดชอบคือ ระบบจัดการโฆษณาแบบจำกัดจำนวนการคลิกและการแสดงโฆษณา เป็นระบบที่พัฒนาขึ้นมาใหม่ต่อจากระบบเดิม ซึ่งจะทำให้ลูกค้าสามารถลงโฆษณากับทาง Wongnai แบบจำกัดจำนวนการแสดงผลและการคลิก อีกทั้งยังสามารถส่งอีเมลรายงานผลการโฆษณากลับไปยังลูกค้าทุก ๆ สัปดาห์โดยอัตโนมัติอีกด้วย

\section{รายละเอียดของงานที่ปฏิบัติ}
ในการปฏิบัติงานครั้งนี้ได้ทำการพัฒนาระบบจัดการโฆษณาแบบจำกัดจำนวนการคลิกและการแสดงโฆษณา เฉพาะฟังก์ชันหลักที่จำเป็นเพื่อให้สามารถส่งมอบงานได้เร็วที่สุดและสามารถทำงานได้เป็นระบบ ได้แก่ ฟังก์ชันการจำกัดการแสดงโฆษณาของร้านด้วยจำนวนการคลิกโฆษณา กับฟังก์ชันการส่งอีเมลรายงานผลการโฆษณากลับไปยังลูกค้าโดยอัตโนมัติทุก ๆ สัปดาห์ โดยในการปฏิบัติงานครั้งนี้ เพื่อให้การพัฒนาระบบเป็นไปอย่างราบรื่น, รวดเร็ว และสามารถทำงานร่วมสมาชิกทีมคนอื่น ๆ ได้อย่างมีประสิทธิภาพ จึงได้มีการนำเทคโนโลยีและเครื่องมือต่าง ๆ มาใช้งาน ได้แก่
\begin{enumerate}
	\item IntelliJ IDEA
	
	IntelliJ IDEA เป็น Integrate Development Environment (IDE) สำหรับใช้ในการพัฒนาซอฟต์แวร์ที่ใช้ Java Virtual Machine (JVM) โดยเฉพาะ มีระบบ Suggestion และ Auto Completion ที่ทำให้การเขียนโค้ดเป็นไปอย่างราบรื่นและรวดเร็ว ~\cite{intellij}
	\item Sequel Pro
	
	Sequel Pro เป็นแอปพลิเคชันสำหรับจัดการฐานข้อมูล MySQL ~\cite{sequelpro}
	\item Postman
	
	Postman เป็นแอปพลิเคชันสำหรับสร้าง API Request เช่น REST, SOAP, GraphQL เพื่อทดสอบการทำงาน API ของ Server และสามารถตรวจสอบ Response ที่ส่งกลับมาได้ ~\cite{postman}
	\item Visual Studio Code
	
	Visual Studio Code เป็น Text Editor ที่รองรับได้หลากหลายภาษา มีระบบ Syntax Highlighting ในการตรวจสอบ Syntax ของโค้ด และสามารถติดตั้งส่วนขยายต่าง ๆ เพิ่มเติมได้ตามความเหมาะสมในการทำงาน ~\cite{vscode}
	\item GitKraken
	
	GitKraken เป็น Git GUI Client ที่ทำให้สามารถใช้งาน Git ได้อย่างสะดวกสบาย ~\cite{gitkraken}
	\item Asana
	
	Asana คือระบบออนไลน์ที่คอยแสดง Workflow ของสมาชิกทีม ทำให้สมาชิกคนอื่น ๆ ในทีมสามารถทราบสถานะงานของแต่ละคนได้อย่างรวดเร็ว ~\cite{asana}
	\item Java
	
	Java เป็นภาษาคอมพิวเตอร์ประเภท Object-Oriented ที่สามารถนำ bytecode ที่ได้จากการคอมไพล์ ไปใช้งานบนคอมพิวเตอร์เครื่องไหนก็ได้ที่มี Java Virtual Machine (JVM) ~\cite{java}
	\item Python
	
	Python เป็นภาษาคอมพิวเตอร์ระดับสูงที่ใช้ Python Interpreter มีจุดเด่นที่สามารถอ่านและทำความเข้าใจโค้ดได้ง่าย โดย Python Interpreter นั้น สามารถติดตั้งได้ในหลากหลายระบบปฏิบัติการ  ~\cite{python}	
	\item MySQL
	
	MySQL เป็นตัวจัดการฐานข้อมูลแบบ Relational (Relational Database Management: RDBMS) ที่เป็น Open source ~\cite{mysql}
	\item Google BigQuery
	
	Google BigQuery เป็น Data Warehouse บน Cloud ที่ให้บริการโดย Google และสามารถใช้ SQL เพื่อใช้งาน Google BigQuery ได้ ~\cite{bigquery}
	\item Git
	
	Git คือ Version Control ที่สามารถติดตามและควบคุมการเปลี่ยนแปลงของโค้ดได้ เพื่อให้ Software Engineer คนอื่น ๆ สามารถทำงานร่วมกันได้อย่างมีประสิทธิภาพ ~\cite{git}
	\item Spring Framework
	
	Spring Framework คือ เฟรมเวิร์คสำหรับพัฒนา REST API, Websocket, Web และอื่น ๆ ของภาษาที่ใช้ Java Virtual Machine (JVM) ~\cite{spring}
	\item Docker
	
	Docker คือ เทคโนโลยีสำหรับสร้าง Container ของซอฟต์แวร์ ทำให้ซอฟต์แวร์สามารถนำไปใช้งานในสภาพแวดล้อมไหนก็ได้ ~\cite{docker}
	\item Kubernetes

	Kubernetes คือ เทคโนโลยีสำหรับจัดการ Cluster (กลุ่มเครื่อง Server) สามารถจัดการ Container ที่กำลังรันระบบเพื่อให้สามารถทำงานได้อย่างต่อเนื่อง มี Downtime เป็นศูนย์ ~\cite{kubernetes}
	\item Gitlab CI/CD
	
	Gitlab CI/CD คือ เครื่องมือในการ Build ซอฟต์แวร์และ Deploy โดยอัตโนมัติ ~\cite{gitlabcicd}
\end{enumerate}

ระบบจัดการโฆษณาแบบจำกัดจำนวนการคลิกและการแสดงโฆษณาที่พัฒนาขึ้นมานั้น ประกอบด้วย Service ต่าง ๆ ได้แก่
\begin{enumerate}
	\item Wongnai Core
	
	Wongnai Core เป็น Service หลักของ Wongnai ถูกพัฒนาด้วยภาษา Java ทำหน้าที่ให้บริการหลาย ๆ อย่าง โดยหน้าที่ของ Wongnai Core ที่เกี่ยวข้องกับระบบจัดการโฆษณาแบบจำกัดจำนวนการคลิกและการแสดงโฆษณา ได้แก่ 
	\begin{itemize}
		\item[-] ควบคุมการแสดงผลโฆษณาของเว็บไซต์ wongnai.com และแอปพลิเคชัน Wongnai
		\item[-] รับข้อมูลจำนวนคลิกของโฆษณา เพื่อนำมาอัปเดตในฐานข้อมูลของ Wongnai Core จากนั้นจึงทำการประมวลผลและพิจารณาว่าควรจะนำโฆษณาที่แสดงอยู่ออกหรือไม่ โดยดูจากจำนวนคลิกของโฆษณาว่าเกินกว่าที่จำกัดไว้ตามที่ตกลงกันหรือไม่ ถ้าเกินก็จะหยุดการแสดงโฆษณานั้น ๆ
		\item[-] รอรับการร้องขอข้อมูลจาก Ad Report Service เพื่อนำข้อมูลไปใช้ในการสร้างรายงานที่สมบูรณ์ส่งกลับไปยังเจ้าของโฆษณา ซึ่งประกอบไปด้วย ชื่อร้าน, อีเมลของร้าน, จำนวนคลิกโฆษณาของร้านที่ใช้ไปแล้ว และจำนวนคลิกโฆษณาของร้านซื้อไว้
	\end{itemize}
	\item Analytics Data Pipeline
	
	Analytics Data Pipeline เป็น Service ขนาดเล็กที่ถูกพัฒนาด้วยภาษา Python ปกติแล้ว Client จะส่งข้อมูลเหตุการณ์ต่าง ๆ ที่เกิดขึ้นใน Wongnai มาเก็บใน Google BigQuery ซึ่งข้อมูลเหตุการณ์ต่าง ๆ นั้นมีหลากหลายมาก โดยข้อมูลที่จำเป็นต้องใช้เพื่อให้แสดงโฆษณาแบบจำกัดจำนวนการคลิกได้ ได้แก่ ข้อมูลที่ผู้ใช้ Wongnai ที่คลิกไปยังโฆษณา ซึ่งข้อมูลเหตุการณ์ที่เกิดขึ้นใน Wongnai ทุก ๆ อย่างนั้นจะถูกเก็บอยู่ในตารางข้อมูลเดียวกันทั้งหมด ทำให้ตารางนั้นเป็นตารางที่มีข้อมูลมหาศาล และการดึงข้อมูลจาก Google BigQuery หนึ่งครั้งจะต้องเสียเครดิตตามขนาดของข้อมูลในตาราง หากดึงจากตารางขนาดใหญ่นั้นโดยตรง จะทำให้สูญเสียเครดิตไปโดยไม่จำเป็น Analytics Data Pipeline จึงถูกพัฒนาขึ้นเพื่อแก้ไขปัญหาในจุดนี้ โดย Service นี้จะทำการใช้คำสั่ง SQL เพื่อสร้างตารางข้อมูลใหม่โดยแยกออกมาจากตารางขนาดใหญ่อีกที และนำข้อมูลเฉพาะส่วนที่ต้องการมาเก็บไว้ ทำให้ได้ตารางข้อมูลที่มีขนาดเล็กลง และมีเฉพาะส่วนที่เราต้องการนำไปใช้จริง ๆ โดยในที่นี้เราจะแยกเฉพาะข้อมูลการแสดงโฆษณาของ Wongnai และข้อมูลที่ผู้ใช้ Wongnai ที่คลิกไปยังโฆษณา หน้าที่อีกอย่างหนึ่งที่สำคัญของ Service นี้ คือการนำข้อมูลการคลิกของโฆษณาที่รวมรวบไปเก็บในตารางขนาดเล็กแล้ว ส่งไปอัปเดตที่ฐานข้อมูลของ Wongnai Core ทุก ๆ วัน เพื่อให้ Wongnai Core นำข้อมูลส่วนนี้ไปประมวลผลต่อ

	\item Ad Report
	
	Ad Report เป็น Service ที่ถูกพัฒนาด้วยภาษา Java ทำหน้าที่สร้างอีเมลรายงานสถิติของโฆษณา ประกอบไปด้วยข้อมูลต่าง ๆ ดังนี้ จำนวนการแสดงผลโฆษณาต่อวัน, จำนวนผู้ที่คลิกเข้าไปในโฆษณาต่อวัน, จำนวนการคลิกของโฆษณาที่ยังคงเหลือ และจำนวนคลิกของโฆษณาที่ลูกค้าซื้อไว้ โดยภายใน Service นี้ จะมีฟังก์ชันหลัก 4 อย่าง ได้แก่
	\begin{itemize}
		\item[-] Statistics Updater
		
		ทำหน้าที่นำข้อมูลของโฆษณาจาก Google BigQuery มาอัปเดตในฐานข้อมูลของ Ad Report
		\item[-] Report
		
		ทำหน้าที่สร้างรายงานที่จะส่งไปพร้อมกับอีเมลให้กับลูกค้า
		\item[-] ReportEmail
		
		ทำหน้าที่สร้างอีเมลพร้อมกับแนบไฟล์รายงานส่งไปยังอีเมลของลูกค้า
		\item[-] RetrieveData
		
		ทำหน้าหน้าที่ร้องขอข้อมูลจาก Wongnai Core ที่จำเป็นต้องใช้เพื่อสร้างการรายงานที่สมบูรณ์
	\end{itemize}
\end{enumerate}

กระบวนการทำงานของระบบจัดการโฆษณาแบบจำกัดจำนวนการคลิกและการแสดงโฆษณา จะเป็นไปตามแผนผังดังต่อไปนี้

\begin{figure}[!h]
	\centering
	\includegraphics[width=1\textwidth]{adreport-diagram.png}  
	\caption{แผนผังภาพรวมการทำงานของระบบจัดการโฆษณาแบบจำกัดจำนวนการคลิกและการแสดงโฆษณา}
	\label{Fig:adreport-diagram}
\end{figure}

\section{ลักษณะขั้นตอนการทำงาน}
ทีม Development ของบริษัท วงใน มีเดีย จำกัด (สำนักงานใหญ่) จะถูกแบ่งออกเป็นทีมย่อย ๆ ตามประเภทของฟังก์ชันที่รับผิดชอบ เรียกว่า Squad ซึ่งจะเป็นทีมแบบ Cross-Functional กล่าวคือ ภายในทีมจะประกอบไปด้วยหลาย ๆ ฝ่าย ได้แก่ Project Manager, Software Engineer (Frontend), Software Engineer (Backend), Software Engineer (iOS), Software Engineer (Android) และ Quality Assurance Engineer

แต่ละ Squad นั้นจะทำงานโดยใช้ Scrum เป็นหลัก Scrum จะทำงานเป็นวงรอบ (Sprint) แต่ละรอบนั้นจะเท่ากับ 1 สัปดาห์ แต่ภายหลังได้มีการปรับเปลี่ยนไปเป็นรอบละ 2 สัปดาห์ โดยจะกิจกรรมที่สำคัญต่าง ๆ ดังต่อไปนี้
\begin{enumerate}
	\item Sprint Planning
	
	เป็นการประชุมตอนต้นรอบ เพื่อรับมอบหมายงานจาก Project Manager และเป็นการประชุมเพื่อปรึกษาหาวิธีการทำงานและวิธีการแก้ไขปัญหาต่าง ๆ ที่เกี่ยวกับงานที่ได้รับมอบหมาย
	
	\item Daily Meeting
	
	เป็นการประชุมแบบสั้น ๆ ประจำวัน มีจุดประสงค์เพื่อให้สมาชิกทีมรับทราบความคืบหน้าของงานที่แต่ละคนกำลังทำอยู่และทราบปัญหาที่เกิดขึ้นระหว่างการทำงาน
	
	\item Backlog Refinement Meeting
	
	เป็นการประชุมตอนกลางรอบ เพื่อพิจารณาว่างานที่ได้รับมอบหมายมา มีขนาดใหญ่หรือเล็กกว่าที่วางแผนไว้หรือไม่ และปรึกษาหาทางแก้ไขที่เหมาะสมกับสถานการณ์
	
	\item Retrospective Meeting
	
	เป็นการประชุมตอนปลายรอบ เพื่อสรุปการทำงานที่ได้ทำไปในรอบ และให้สมาชิกภายในทีมอธิบายปัญหาที่เกิดขึ้นในรอบ รวมไปถึงเรื่องราวดี ๆ ที่เกิดขึ้นในรอบด้วย เพื่อนำไปปรับปรุงการทำงานในรอบถัดไป
\end{enumerate}

การติดต่อสื่อสารภายในองค์กรจะใช้ Slack เป็นหลัก สถานะของงานภายในทีมสามารถดูได้จาก Kanban Board ซึ่งเป็นบอร์ดที่ตั้งอยู่ในพื้นที่ทำงาน และ Asana ซึ่งเป็นระบบออนไลน์ที่จะทำให้สมาชิกภายในทีมสามารถทราบสถานะของงานได้อย่างรวดเร็ว ภายในกระบวนการทำงาน สถานะของงานจะเป็นไปตามดังต่อไปนี้

\begin{enumerate}
	\item To do
	
	งานที่ยังไม่ได้เริ่มทำ แต่อยู่ในรอบแล้วจะมีสถานะเป็น To do
	
	\item In progress
	
	งานที่กำลังทำอยู่จะมีสถานะเป็น In progress
	
	\item Review
	
	เมื่องานที่ทำอยู่เสร็จแล้ว ก่อนที่จะนำงานส่วนที่ทำเข้าไปในระบบ Beta ซึ่งเป็นระบบที่มีไว้ทดสอบก่อนที่จะใช้งานจริง โค้ดที่เขียนขึ้นมาจะต้องผ่านการตรวจสอบจาก Software Engineer คนอื่นอย่างน้อย 2 คนก่อน จึงจะสามารถส่งไปให้ Quality Assurance Engineer ทำการทดสอบต่อได้
	
	\item Review passed
	
	เมื่องานที่ทำอยู่ผ่านการตรวจสอบโดย Software Engineer คนอื่นครบ 2 คนแล้ว งานจะอยู่ในสถานะ Review passed 
	
	\item Testing
	งานที่อยู่ในสถานะ Review passed จะถูกส่งต่อให้ Quality Assurance Engineer ทดสอบ ซึ่งก่อนที่จะให้ Quality Assurance Engineer ทดสอบนั้น จะต้องเตรียมวิธีการทดสอบและเตรียมข้อมูลให้เรียบร้อยก่อน
	
	\item Test passed
	
	เมื่อ Quality Assurance Engineer ทดสอบเสร็จแล้ว งานจะอยู่ในสถานะ Test passed สามารถนำงานเข้าระบบ Beta ได้เลย
	
	\item Done
	
	เมื่อนำงานขึ้นระบบ Beta เสร็จแล้ว งานจะมีสถานะเป็น Done แต่อย่างไรก็ตาม เจ้าของงานจะต้องติดตามงานของตัวเองจนกว่างานจะขึ้นอยู่บนระบบที่ใช้งานจริง
\end{enumerate}

โดยส่วนมากแล้ว ถ้าเป็นงานที่เป็นการเขียนโค้ด จะมีกระบวนตามที่กล่าวมา แต่อย่างไรก็ตามงานบางชนิดไม่จำเป็นต้องทำตามกระบวนการอย่างเคร่งครัดก็ได้ ขึ้นอยู่กับความเหมาะสมของงานว่าควรจะเป็นแบบไหน เช่น งานบางชิ้นที่เป็นการสร้างเครื่องมือให้กับพนักงานฝ่ายอื่นในบริษัทใช้ เราสามารถให้พนักงานฝ่ายนั้น ซึ่งเป็นผู้ใช้งานโดยตรงเป็นผู้ทดสอบงานของเราแทนก็ได้ เพื่อที่จะนำความคิดเห็นไปปรับปรุงงานได้อย่างตรงจุดที่สุด

การทำงานของทีม Development ที่เป็นการเขียนโค้ดจะใช้ Test Driven Development (TDD) เป็นหลัก เป็นการเขียนชุดทดสอบของโค้ดขึ้นมาก่อน แล้วรันชุดสอบให้เกิดข้อผิดพลาด จากนั้นจึงเขียนโค้ดเพื่อแก้ไขไม่ให้เกิดข้อผิดพลาดนั้น ระหว่างการเขียนโค้ดจะต้องคอยคำนึงถึงคุณภาพของโค้ด หากมีโค้ดส่วนที่ทำงานซ้ำกันจะต้องทำการ Refactoring โค้ดส่วนนั้นด้วย

\begin{figure}[!h]
	\centering
	\includegraphics[width=0.8\textwidth]{kanban-board.png}  
	\caption{Kanban Board ที่ตั้งอยู่ในพื้นที่ทำงาน}
	\label{Fig:kanban-board}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[width=1\textwidth]{asana.png}  
	\caption{ตัวอย่างของโปรแกรม Asana}
	\label{Fig:asana}
\end{figure}